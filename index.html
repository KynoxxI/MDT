<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LSPD Mobile Data Terminal</title>
  <link rel="stylesheet" href="styles.css"/>
  <meta name="color-scheme" content="dark light">
</head>
<body>
  <div id="app">
    <!-- Barre latÃ©rale -->
    <aside class="sidebar">
      <div class="brand">
        <span class="brand-badge">LSPD</span>
        <span class="brand-title">Mobile Data Terminal</span>
      </div>
      <nav class="nav">
        <button data-route="dashboard" class="nav-item">Dashboard</button>
        <button data-route="citizens" class="nav-item">Citoyens</button>
        <button data-route="vehicles" class="nav-item">VÃ©hicules</button>
        <button data-route="cases" class="nav-item">Dossiers</button>
        <button data-route="warrants" class="nav-item">Mandats</button>
        <button data-route="reports" class="nav-item">Rapports</button>
        <button data-route="admin" class="nav-item role-admin">Administration</button>
      </nav>
      <div class="sidebar-bottom">
        <div class="user-info">
          <div class="avatar">ðŸ‘®</div>
          <div>
            <div id="user-name">InvitÃ©</div>
            <div id="user-role" class="role">â€”</div>
          </div>
        </div>
        <button id="logout" class="logout">DÃ©connexion</button>
      </div>
    </aside>

    <!-- Contenu principal -->
    <main class="main">
      <header class="topbar">
        <div class="search">
          <input id="global-search" type="text" placeholder="Recherche globaleâ€¦"/>
          <button id="search-btn">Rechercher</button>
        </div>
        <div class="top-actions">
          <button id="quick-create" class="primary">+ Nouveau rapport</button>
        </div>
      </header>

      <section id="view" class="view"></section>
    </main>
  </div>

  <!-- Modale gÃ©nÃ©rique -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Titre</h3>
        <button id="modal-close" class="icon">âœ•</button>
      </div>
      <div id="modal-body" class="modal-body"></div>
      <div class="modal-footer">
        <button id="modal-cancel">Annuler</button>
        <button id="modal-confirm" class="primary">Confirmer</button>
      </div>
    </div>
    <div class="modal-backdrop"></div>
  </div>

  <!-- Ã‰cran de connexion -->
  <div id="login-screen" class="login-screen">
    <form id="login-form" class="login-card">
      <h2>Connexion MDT</h2>

      <div class="card" style="padding: 0; border: none; background: transparent;">
        <p class="hint">Connexion recommandÃ©e via Discord (OAuth2)</p>
        <a id="discord-login-link" href="#" rel="noopener">
          <button type="button" class="primary" style="width: 100%;">Connexion via Discord</button>
        </a>
        <p id="discord-status" class="hint" style="margin-top: 8px;">Statut: En attente</p>
      </div>

      <hr style="border: none; border-top: 1px solid #263042; margin: 12px 0;"/>

      <p class="hint">Mode dÃ©mo (local): nâ€™importe quel identifiant/mot de passe est acceptÃ©.</p>
      <label>Identifiant
        <input name="username" required placeholder="ex: j.doe"/>
      </label>
      <label>Mot de passe
        <input name="password" type="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"/>
      </label>
      <label>RÃ´le
        <select name="role">
          <option value="officer">Agent</option>
          <option value="sergeant">Sergent</option>
          <option value="detective">DÃ©tective</option>
          <option value="admin">Administrateur</option>
        </select>
      </label>
      <button type="submit" class="primary">Se connecter</button>
    </form>
  </div>

  <!-- Configuration OAuth Discord cÃ´tÃ© front (lâ€™appel du token nÃ©cessite un backend) -->
  <script>
    // Tes identifiants Discord
    const DISCORD_CLIENT_ID = '1358102682904166490';
    const REDIRECT_URI = 'https://kynoxxi.github.io/MDT/'; // doit correspondre au Developer Portal

    // Construire lâ€™URL dâ€™autorisation OAuth2
    const oauthAuthorizeURL = new URL('https://discord.com/oauth2/authorize');
    oauthAuthorizeURL.searchParams.set('client_id', DISCORD_CLIENT_ID);
    oauthAuthorizeURL.searchParams.set('redirect_uri', REDIRECT_URI);
    oauthAuthorizeURL.searchParams.set('response_type', 'code');
    oauthAuthorizeURL.searchParams.set('scope', 'identify');

    // Injecter lâ€™URL dans le bouton
    const discordLink = document.getElementById('discord-login-link');
    discordLink.href = oauthAuthorizeURL.toString();

    // Afficher le statut si ?code= prÃ©sent (Discord a redirigÃ©)
    const params = new URLSearchParams(location.search);
    const code = params.get('code');
    const discordStatus = document.getElementById('discord-status');
    if (code) {
      discordStatus.textContent = 'Statut: Code reÃ§u de Discord âœ” â€” Ã©change de code Ã  implÃ©menter cÃ´tÃ© serveur';
      // Note: Ici il faut un backend pour Ã©changer "code" contre "access_token".
      // Ensuite, le backend renvoie les infos utilisateur (username, id) au frontend.
    }
  </script>

  <script src="app.js"></script>
</body>
</html>
